-- H2, compatibil Postgres
-- default pe CREATED_AT
CREATE TABLE recipes (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  difficulty VARCHAR(32) NOT NULL,
  cook_time_minutes INT NOT NULL,
  steps CLOB,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);

CREATE TABLE ingredients (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name VARCHAR(255) NOT NULL UNIQUE,
  unit VARCHAR(32) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);

CREATE TABLE recipe_ingredients (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  recipe_id BIGINT NOT NULL,
  ingredient_id BIGINT NOT NULL,
  quantity DECIMAL(19,2) NOT NULL,
  CONSTRAINT fk_ri_recipe     FOREIGN KEY (recipe_id)    REFERENCES recipes(id)    ON DELETE CASCADE,
  CONSTRAINT fk_ri_ingredient FOREIGN KEY (ingredient_id) REFERENCES ingredients(id) ON DELETE CASCADE
);

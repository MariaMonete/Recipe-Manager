{
  "id": null,
  "uid": "rm-http",
  "title": "Recipe Manager - HTTP",
  "tags": ["recipe-manager", "http"],
  "schemaVersion": 39,
  "version": 1,
  "refresh": "30s",
  "time": { "from": "now-6h", "to": "now" },
  "panels": [
    {
      "type": "stat",
      "title": "RPS (last 5m)",
      "id": 10,
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "targets": [
        { "refId": "A", "expr": "sum(rate(http_server_requests_seconds_count[5m]))", "instant": true }
      ],
      "fieldConfig": { "defaults": { "unit": "ops", "decimals": 2 }, "overrides": [] },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "value" },
      "gridPos": { "h": 6, "w": 6, "x": 0, "y": 0 }
    },
    {
      "type": "stat",
      "title": "Error rate 5xx (%)",
      "id": 11,
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "targets": [
        { "refId": "A", "expr": "100 * sum(rate(http_server_requests_seconds_count{status=~\"5..\"}[5m])) / sum(rate(http_server_requests_seconds_count[5m]))", "instant": true }
      ],
      "fieldConfig": { "defaults": { "unit": "percent", "decimals": 2 }, "overrides": [] },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "value" },
      "gridPos": { "h": 6, "w": 6, "x": 6, "y": 0 }
    },
    {
      "type": "timeseries",
      "title": "Requests by status (RPS)",
      "id": 12,
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "targets": [
        { "refId": "A", "expr": "sum by (status) (rate(http_server_requests_seconds_count[5m]))", "legendFormat": "{{status}}" }
      ],
      "fieldConfig": { "defaults": { "unit": "ops", "decimals": 2 }, "overrides": [] },
      "options": { "legend": { "displayMode": "table", "placement": "right" }, "tooltip": { "mode": "single" } },
      "gridPos": { "h": 9, "w": 12, "x": 0, "y": 6 }
    },
    {
      "type": "timeseries",
      "title": "Latency p95 (s)",
      "id": 13,
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "targets": [
        {
          "refId": "A",
          "expr": "histogram_quantile(0.95, sum by (le) (rate(http_server_requests_seconds_bucket[5m])))",
          "legendFormat": "p95"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "s", "decimals": 3 }, "overrides": [] },
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "single" } },
      "gridPos": { "h": 9, "w": 12, "x": 12, "y": 6 }
    },
    {
      "type": "timeseries",
      "title": "Top endpoints by RPS",
      "id": 14,
      "datasource": { "type": "prometheus", "uid": "Prometheus" },
      "targets": [
        {
          "refId": "A",
          "expr": "topk(5, sum by (uri) (rate(http_server_requests_seconds_count[5m])))",
          "legendFormat": "{{uri}}"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "ops", "decimals": 2 }, "overrides": [] },
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "single" } },
      "gridPos": { "h": 9, "w": 24, "x": 0, "y": 15 }
    }
  ],
  "annotations": { "list": [ { "type": "dashboard", "name": "Annotations & Alerts", "enable": true } ] }
}
